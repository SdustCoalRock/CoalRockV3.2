unit ReportWord;

interface
uses
  System.SysUtils,Vcl.ExtCtrls,unWord_Lu,PStope_GzmGuidClass ,
  uDrawGraphClass,Word2000, Vcl.ComCtrls,System.Classes,Vcl.Forms;

type
    TWordReport = class(TMyWord)

    private
         ExHandle:THandle;
        iDwGrap:TDrawGrap;
        innWord:TMyWord;
        function  Get_Cmff(id:integer):String;         //采煤方法
        function  Get_Coal_F(id:integer):String;       //煤体应力
        function  Get_JYHD(id:integer):String;           //基岩厚度
        function  Get_HangDao_Stress(id:integer):String; //巷道压力
        function  Get_HangDao_support(id:integer):String; //巷道支护方式
        function  Get_support_type(id:integer):String; //支架型号
        function  Get_DZGZ(id:integer):String;  //地质构造
        function  Get_WSFC(id:integer):String;  //瓦斯含量
        function  Get_TopWater(id:integer):String;  //顶板水源
        function  Get_BottomWater(id:integer):String;  //地板水源
        function  Get_RockPress(id:integer):String;  //矿压情况
        function  Get_YxFx(id:integer):String;  //仰斜与俯斜
        // main Myword
        Procedure CreateWordClass();
        procedure FreeMyWordClass();
        procedure AddDocmentTitle(CoalName,WorkFaceName,ReportType:String);
        procedure ADDWorkFaceInFo_1(inGzm:TGzm);
        procedure ADDDrilleInFo_2(inGzm:TGzm);
        procedure AddFYYDInfo_3(inGzm:TGzm;ReportType:String);
        procedure AddYDFZInfo_4(inGzm:TGzm);
        procedure AddSupportInfo_5(inGzm:TGzm);
        procedure AddSupSubject_6(inGzm:TGzm);

        //------------------
        procedure AddYklhInfo_5(inGzm:TGzm);
        procedure AddYklhInfo_5_2;

        procedure Add_disclaimer(Xhstr:String);

       //
        procedure DeleteBmPFile;
        function  isExsitBmpFile(BmpFile:string):Boolean;
        function  Report_Zcyl(inGzm:TGzm):Boolean;
        //report 矿压分析
        procedure Add_Kyfx_Cover(CoalName, WorkFaceName:String);    // 制作报告封面
        procedure Add_WorkFace_BasicInformation(inGzm:TGZM);


        procedure Add_Contents;// 制作目录


    public

        procedure ReportZhijia(AHandle:THandle;inGzm:TGzm); //打印支架报告
        procedure ReportYklh(AHandle:THandle;inGzm:TGzm);//  打印沿空留巷
        //
        procedure SetDrawGraph(iDw:TDrawGrap);
        procedure ReportAnsysisRockPress(AHandle:THandle;inGzm:TGZM);

        constructor Create;
        destructor  Destroy;

    end;


implementation

{ TWordReport }

uses UMainDataModule, Lu_Public_BasicModual,IOUtils;
Procedure CreateWordClass(MyUseWord:TMyWord);
begin

end;

procedure TWordReport.AddDocmentTitle(CoalName, WorkFaceName,ReportType: String );
var
  title:String;
  i:integer;
begin
    with innWord do begin
         if ReportType='Support' then  begin
            title:=CoalName+'【'+WorkFaceName+'】液压支架选型报告';
         end else if ReportType='Yklh' then begin
            title:=CoalName+'【'+WorkFaceName+'】沿空留巷技术报告';
         end;

         SetFont('楷体_GB2312',18,false,false);
         AlignLine(1);  //居中
         AddLine(title,16); //报告标题

    end;
end;

procedure TWordReport.ADDDrilleInFo_2( inGzm: TGzm);
var
  str:string;
  i:integer;
begin
     with innWord do begin
          AddReturn();   //加一个空行
          SetFont('宋体',15,false,false);
          AlignLine(1);
          addline('二、钻孔信息',18);// 章节
          AddReturn();
           //正文
          SetFont('宋体',13,false,false);
          AlignLine(0);
          WriteText('    该次测算使用的钻孔名称为：'+inGzm.UsedDrill.Zk_name +
                    '，该钻孔录入岩层：'+IntToStr(inGzm.UsedDrill.Zk_Yc_Count)+'层。'+#13);

          AlignLine(1);
          SetFont('宋体',10,true,false);
          AddTable(6,inGzm.UsedDrill.Zk_Yc_Count);
          WriteText('岩层序号');   MoveRight(1);
          WriteText('岩层名称');   MoveRight(1);
          WriteText('均厚(米)');   MoveRight(1);
          WriteText('岩石容重');   MoveRight(1);
          WriteText('抗压MPa');    MoveRight(1);
          WriteText('抗拉MPa');    MoveRight(1);

          SetFont('宋体',10,false,false);
          for I := 0 to inGzm.UsedDrill.Zk_Yc_Count-1 do   begin
              WriteText(inttoStr(i+1));                       MoveRight(1);
              WriteText(inGzm.UsedDrill.Yc_Rock[i].R_Name);   MoveRight(1);
              WriteText(FormatFloat('#.##',inGzm.UsedDrill.Yc_Rock[i].R_h));      MoveRight(1);
              WriteText(FormatFloat('#.##',inGzm.UsedDrill.Yc_Rock[i].R_r));      MoveRight(1);
              WriteText(FormatFloat('#.##',inGzm.UsedDrill.Yc_Rock[i].R_kyqd));   MoveRight(1);
              WriteText(FormatFloat('#.##',inGzm.UsedDrill.Yc_Rock[i].R_klqd));   MoveRight(1);
          end;
          MoveDown(inGzm.UsedDrill.Zk_Yc_Count);

     end;
end;


procedure TWordReport.AddFYYDInfo_3(inGzm: TGzm;ReportType:String);
var
  Pic_Path:Ansistring;
begin
    Pic_Path:=Public_Basic.Get_MyModulePath+'saveBmp\FYYD\';
    with innWord do begin
          AlignLine(0);
          AddReturn();   //加一个空行
          SetFont('宋体',15,false,false);
          addline('三、覆岩运动规律',14);// 章节
          AddReturn();
           //正文
          SetFont('黑体',13,false,false);
          addline('1、三种算法',20);
          AddReturn();
          AlignLine(1);
          SetFont('宋体',10,true,false);
          AddTable(1,6);
          if self.isExsitBmpFile(Pic_Path+'NQF.JPG') then
             AddPicture(Pic_Path+'NQF.JPG');
          MoveRight(1);
          WriteText('图3.1 覆岩运动规律挠曲算法图示');
          MoveRight(1);
          if self.isExsitBmpFile(Pic_Path+'BJF.JPG') then
             AddPicture(Pic_Path+'BJF.JPG');
          MoveRight(1);
          WriteText('图3.2 覆岩运动规律步距算法图示');
          MoveRight(1);
           if self.isExsitBmpFile(Pic_Path+'ZHSF.JPG') then
             AddPicture(Pic_Path+'ZHSF.JPG');
          MoveRight(1);
          WriteText('图3.3 覆岩运动规律综合算法图示');
          MoveDown(1);

          AddReturn();

          AlignLine(0);

          SetFont('黑体',13,false,false);
          addline('2、覆岩运动规律',20);
          AddReturn();
          SetFont('宋体',13,false,false);
//          WriteText('   直接顶运动参数：'+StrPas(Main_CallPStope.UsePStope.Get_immediate_roof('1.0')));
//          AddReturn();
//          WriteText('   老顶运动参数：'+StrPas(Main_CallPStope.UsePStope.Get_Old_roof('1.0')));
          AddReturn();
          {为沿空留巷定制}
          if ReportType='Yklh' then begin
              SetFont('黑体',13,false,false);
              addline('3、承压力分布规律',20);
              AddReturn();
              SetFont('宋体',13,false,false);
              Report_Zcyl(inGzm);
          end;
    end;
end;

procedure TWordReport.AddSupportInfo_5(inGzm: TGzm);
var
  i,selectedid:integer;
  Image1:TImage;
  Pic_Path,DispStr:string;
begin
   Image1 := TImage.Create(nil);
   Pic_Path:=Public_Basic.Get_MyModulePath+'saveBmp\FYYD\';
   try
    with innWord do begin
          AlignLine(0);
          AddReturn();   //加一个空行
          SetFont('宋体',15,false,false);
          addline('五、支架选型',18);// 章节
          AddReturn();
           //正文
          SetFont('黑体',13,false,false);
          addline('1、开采条件影响值',20);
          AddReturn();
          AlignLine(1);
          SetFont('宋体',10,true,false);
          AddTable(8,2);
          WriteText('直接顶类别');MoveRight(1);
          WriteText('基本顶类别');MoveRight(1);
          WriteText('底板类别');MoveRight(1);
          WriteText('工作阻力/KN');MoveRight(1);
          WriteText('采高/m');MoveRight(1);
          WriteText('矿井瓦斯');MoveRight(1);
          WriteText('冒放性类别');MoveRight(1);
          WriteText('煤层倾角');MoveRight(1);
          for I := 0 to 7 do  begin
//             selectedid:= t_SupWeigth.WorkFaceInfo.Child_Second[i].selected ;
//             WriteText(t_SupWeigth.WorkFaceInfo.Child_Second[i].Child_Third[selectedid].Name );
//             if i<7 then   MoveRight(1);

          end;

          MoveDown(1);

          AddReturn();

          AlignLine(0);
          SetFont('黑体',13,false,false);
          addline('2、注意事项',20);
          AddReturn();
          SetFont('宋体',13,false,false);
          WriteText('液压支架阻力计算建议值：');
          AddReturn();
//          WriteText(StrPas(Main_CallPStope.UsePStope.Get_Support_P('1.0')));
//
//          AddReturn();
//
//          AlignLine(0);
//          SetFont('黑体',13,false,false);
//          addline('3、支架设计专家建议结构选项',20);
//
//          AddReturn();
//          SetFont('宋体',10,true,false);
//          AddTable(1,1);
//          for I := 0 to t_SupWeigth.SupportInfo.Child_count-1 do  begin
//            selectedid:=t_SupWeigth.SupportInfo.Child_Second[i].Selected;
//            MainDataModule.MySqliteDataBase.GetBMPToSQlite(
//                t_SupWeigth.SupportInfo.Child_Second[i].Child_Third[selectedid].id,'3',Image1.Picture.Bitmap  );
//             Image1.Width :=Image1.Picture.Bitmap.Width ;
//             Image1.Height :=Image1.Picture.Bitmap.Height ;
//
//             if Public_Basic.Licensing  then  Public_Basic.AddSingleTextWater(Image1)
//               else Public_Basic.AddMultTextWater(Image1);
//
//            Image1.Picture.SaveToFile(Pic_Path+'Supp.bmp');
//            AlignLine(0);
//            DispStr:=IntToStr(i+1)+'、'+t_SupWeigth.SupportInfo.Child_Second[i].Name+
//                     ' 选用: '+ t_SupWeigth.SupportInfo.Child_Second[i].Child_Third[selectedid].BianMa+'【'+
//                      t_SupWeigth.SupportInfo.Child_Second[i].Child_Third[selectedid].Name   +'】' ;
//            WriteText(DispStr);  MoveRight(1);
//            AlignLine(1);
//            if self.isExsitBmpFile(Pic_Path+'Supp.bmp') then
//               AddPicture(Pic_Path+'Supp.bmp');
//            if i< t_SupWeigth.SupportInfo.Child_count-1 then
//               MoveRight(1);
//
//          end;
          MoveDown(1);

    end;
   finally
      Image1.Free;
   end;
end;

procedure TWordReport.AddSupSubject_6(inGzm: TGzm);
begin
end;

procedure TWordReport.ADDWorkFaceInFo_1(inGzm: TGzm);
var
  str:string;
begin
  with innWord do begin
      AlignLine(0);
      AddReturn();   //加一个空行
      SetFont('宋体',14,false,false);
      Addline('一、工作面基本信息',18);// 章节
      AddReturn();
       //正文
      SetFont('宋体',13,false,false);
      str:='  模拟开采工作面名称为【'+inGzm.S_Name+'】煤层平均厚度为' +
                  FormatFloat('#.##',inGzm.S_Agv_mch) +'米, 设定开采高度为' +
                  FormatFloat('#.##',inGzm.S_Cg_h)+'米, 采煤方法是' +
                  Get_Cmff(inGzm.S_CMFS_INteger)+ ',工作面上界采深是'+FormatFloat('#.##',inGzm.S_Sh_UP)+
                  '米,下界采深是'+FormatFloat('#.##',inGzm.S_Sh_Down)+'米，平均采深是'   +
                  FormatFloat('#.##',inGzm.S_mcsd_h)+'米';
      WriteText(str);
      AddReturn();
      str:='  该工作面推进长度是'+FormatFloat('#.##',inGzm.S_Sx_zx )+'米，'+
                '倾斜长度是'+FormatFloat('#.##',inGzm.S_L_qx)+'米，'   +
                '煤层硬度是'+Get_Coal_F(round(inGzm.S_f_PS))+',基岩厚度是'+Get_JYHd(inGzm.Dz_JYHD)+
                ',每天推进'+FormatFloat('#.##',inGzm.S_DayStep_speed)+'米左右。' ;

      WriteText(Str);
      AddReturn();

      Str:='  该次模拟计算使用的液压支架参数为:'+
                '中心距：'+ FormatFloat('#.##',inGzm.Usedsupport.Zj_zhongxinju) +  '米,'+
                '控顶距：'+ FormatFloat('#.##',inGzm.Usedsupport.Zj_KongdingJU) +  '米,'+
                '合力作用点：'+ FormatFloat('#.##',inGzm.Usedsupport.Zj_hlzyd)  +  '米,'+
                '立柱数量：'+ IntTostr(inGzm.Usedsupport.Zj_Lizhu_count) +  '个。';
      WriteText(Str);
      AddReturn();
  end;
end;

procedure TWordReport.AddYDFZInfo_4(inGzm: TGzm);
var
  Pic_Path:Ansistring;
begin
    Pic_Path:=Public_Basic.Get_MyModulePath+'saveBmp\FYYD\';
    with innWord do begin
          AlignLine(1);
          AddReturn();   //加一个空行
          SetFont('宋体',15,false,false);
          addline('四、采场开采覆岩运动模拟',18);// 章节
          AddReturn();
           //正文
          AlignLine(1);
          SetFont('宋体',10,true,false);
          AddTable(1,12);
          if self.isExsitBmpFile(Pic_Path+'IMM0.JPG') then
             AddPicture(Pic_Path+'IMM0.JPG');
          MoveRight(1);
          WriteText('图4.1 开采模拟初始状态图');
          MoveRight(1);
          if self.isExsitBmpFile(Pic_Path+'IMM1.JPG') then
             AddPicture(Pic_Path+'IMM1.JPG');
          MoveRight(1);
          WriteText('图4.2 直接顶初次垮落示意图');
          MoveRight(1);
          if self.isExsitBmpFile(Pic_Path+'IMM2.JPG') then
             AddPicture(Pic_Path+'IMM2.JPG');
          MoveRight(1);
          WriteText('图4.3 顶板冒落形成示意图');
          MoveRight(1);
          if self.isExsitBmpFile(Pic_Path+'IMM3.JPG') then
             AddPicture(Pic_Path+'IMM3.JPG');
          MoveRight(1);
          WriteText('图4.4 老顶初次来压示意图');
          MoveRight(1);
          if self.isExsitBmpFile(Pic_Path+'IMM4.JPG') then
             AddPicture(Pic_Path+'IMM4.JPG');
          MoveRight(1);
          WriteText('图4.5 老顶周期来压示意图');
          MoveRight(1);
          if self.isExsitBmpFile(Pic_Path+'IMM5.JPG') then
             AddPicture(Pic_Path+'IMM5.JPG');
          MoveRight(1);
          WriteText('图4.6 采动见方顶板运动示意图');
          MoveDown(1);

    end;

end;

procedure TWordReport.AddYklhInfo_5(inGzm: TGzm);
var
  i,selectedid:integer;
  Image1:TImage;
  Pic_Path,DispStr:string;
begin
   Image1 := TImage.Create(nil);
   Pic_Path:=Public_Basic.Get_MyModulePath+'saveBmp\FYYD\';
   try
    with innWord do begin
          AlignLine(0);
          AddReturn();   //加一个空行
          SetFont('宋体',15,false,false);
          addline('五、沿空留巷可行性分析方案',18);// 章节
          AddReturn();
           //正文
          SetFont('黑体',13,false,false);
          addline('1、工作面顶板分布信息',20);
          AddReturn();
          AlignLine(1);
          SetFont('宋体',10,true,false);
          AddTable(8,2);
          WriteText('直接顶类别');MoveRight(1);
          WriteText('基本顶类别');MoveRight(1);
          WriteText('底板类别');MoveRight(1);
          WriteText('工作阻力/KN');MoveRight(1);
          WriteText('采高/m');MoveRight(1);
          WriteText('矿井瓦斯');MoveRight(1);
          WriteText('冒放性类别');MoveRight(1);
          WriteText('煤层倾角');MoveRight(1);
//          for I := 0 to 7 do  begin
//             selectedid:= t_SupWeigth.WorkFaceInfo.Child_Second[i].selected ;
//             WriteText(t_SupWeigth.WorkFaceInfo.Child_Second[i].Child_Third[selectedid].Name );
//             if i<7 then   MoveRight(1);
//
//          end;

          MoveDown(1);

          AddReturn();
        // 添加5.2 其他内容
         AddYklhInfo_5_2;



    end;
   finally
      Image1.Free;
   end;

end;

procedure TWordReport.AddYklhInfo_5_2;
begin

end;

procedure TWordReport.Add_Contents;
var
   title:String;
begin
    with innWord do begin
        GotoBookMark('目录');
        AddReturn();
        title:='目  录';
        SetFont('楷体_GB2312',18,true,false);
        AlignLine(1);  //居中
        AddLine(title,1); //报告标题   标题编号为1
        AddReturn();

        InsertContents;
    end;
end;

procedure TWordReport.Add_disclaimer(Xhstr:String);
begin
     with innWord do begin
          AlignLine(1);
          AddReturn();   //加一个空行
          SetFont('宋体',15,false,false);
          addline(Xhstr+ '、补充建议',18);// 章节
          AddReturn();
           //正文
          AlignLine(0);
          SetFont('宋体',13,false,false);
          WriteText('    本计算主要是使用钻孔柱状图的信息,关于岩石力学参数采用的是经验值,给出的结论仅供参考, ' +
                    ' 如果想确定对采煤工作面有实用性的数据,需要加强现场矿压观测校订关键参数！');

     end;
end;

procedure TWordReport.Add_Kyfx_Cover(CoalName, WorkFaceName:string);
var
  title:String;
  i:integer;
  Pic_Path:string;
  tab:Table;
begin

    Pic_Path:=Public_Basic.Get_MyModulePath;
    with innWord do begin
        title:=CoalName+'【'+WorkFaceName+'】矿压分析报告';
        SetFont('宋体',18,true,false);
        AlignLine(1);  //居中
        for I := 0 to 1 do
            AddReturn();
        AddLine(title,1); //报告标题   标题编号为1

        for I := 0 to 1 do
            AddReturn();
        title:='分析数据时间：【'+FormatDatetime('YYYY-MM-DD HH:NN:SS',iDWGrap.DataTimeAndFootAge.StartTime  )+'-'+
                    FormatDatetime('YYYY-MM-DD HH:NN:SS',iDWGrap.DataTimeAndFootAge.EndTime ) +'】';

        SetFont('宋体',14,true,false);
        AlignLine(1);  //居中  //
        AddLine(title,1); //报告副标题   标题编号为1
        for I := 0 to 3 do
            AddReturn();

         // 插入图标
         tab:=AddTable(3,1); moveright(1);
         TableBorders(tab,0,0);
         if self.isExsitBmpFile(Pic_Path+'BJTP\cover.jpg') then
             AddPicture(Pic_Path+'BJTP\cover.jpg');
         MoveDown(1);

         for I := 0 to 7 do
            AddReturn();
         //

         // 插入单位与时间
        title:=MainDataModule.Coal_Name+'生产科矿压工作组编制';
        SetFont('宋体',14,true,false);
        AlignLine(1);  //居中  //
        AddLine(title,1); //
        title:=public_Basic.UseUnitName+'支持' ;
        SetFont('宋体',14,true,false);
        AlignLine(1);  //居中  //                                 ;
        AddLine(title,1); //
        AddReturn();
        // 时间
        title:=FormatDatetime('YYYY 年 MM 月 DD 日 ',now());
        AlignLine(1);  //居中  //
        AddLine(title,1); //
        AddReturn();
        //插入分页符
        SetpageHeadFootName( '',''  );
        insertPage(1);
        AddReturn();
        //插入目录标记
        createBookMark('目录' );
         //插入分页符
        SetpageHeadFootName( MainDataModule.Coal_Name+MainDataModule.WorkFace_Name+'矿压深度分析报告',
                            MainDataModule.Coal_Name+'生产科矿压工作组编制'
                            );
        insertPage(1);
        AddReturn();

    end;


end;

procedure TWordReport.Add_WorkFace_BasicInformation(inGzm: TGZM);
var
  str:string;
  Richedit1:Trichedit;
  fileName,textString:Ansistring;
  DirName:Ansistring;
  Dll_Path:AnsiString;

begin
   Dll_Path:=Public_Basic.Get_MyModulePath;
   DirName:=DLL_path+'\InputData\WorkDace_'+IntTostr(inGzm.Gzmbh)+'\';

  try
    Richedit1:=Trichedit.CreateParented(ExHandle);
    with innWord do begin
      AlignLine(0);
      SetFont('宋体',20,true,false);
      Addline('1 工作面地质及开采条件',24);// 章节
         SetFont('宋体',14,false,false);
         Addline('1.1 工作面地质及开采条件',26);// 章节
         SetFont('宋体',12,false,false);
         Addline('1.1.1 工作面地质及开采条件',27);// 章节
         if MainDataModule.ReadRichTextFromDataBase(RichEdit1.Lines,'GZMBASIC','rtf',
                         inGzm.Gzmbh ,101,-1,-1) then begin
             RichEdit1.Lines.SaveToFile(DirName+'B001.rtf');
             AlignLine(1);
             SetFont('宋体',8,true,false);
             WriteText('表1-1 工作面地质及开采条件表');
             AddReturn();
             AlignLine(0);
             SetFont('宋体',10,false,false);
             insertotherfile(DirName+'B000.rtf');
         end else begin
              // 填写本程序书写的 格式
             ADDWorkFaceInFo_1(inGzm);
         end;
         AddReturn();
         SetFont('宋体',12,false,false);
         Addline('1.1.2 顶底板岩层岩性组合结构分析',27);// 章节
         SetFont('宋体',10,false,false);
         if MainDataModule.ReadRichTextFromDataBase(RichEdit1.Lines,'GZMBASIC','rtf',
                         inGzm.Gzmbh ,102,-1,-1) then begin
            RichEdit1.Lines.SaveToFile(DirName+'B002.rtf');
            insertotherfile(DirName+'B002.rtf');
         end;
         AddReturn();
         SetFont('宋体',12,false,false);
         Addline('1.1.3 地质构造情况',27);// 章节
         SetFont('宋体',10,false,false);
         if MainDataModule.ReadRichTextFromDataBase(RichEdit1.Lines,'GZMBASIC','rtf',
                         inGzm.Gzmbh ,103,-1,-1) then begin
            RichEdit1.Lines.SaveToFile(DirName+'B003.rtf');
            insertotherfile(DirName+'B003.rtf');
         end;
         AddReturn();


      Addline('1.1 工作面基本概况',26);// 章节


      Addline('1.2 工作面钻孔信息',26);// 章节



      Addline('1.3 工作面支护信息',26);// 章节


//      //正文
//      SetFont('宋体',13,false,false);
//      str:='  模拟开采工作面名称为【'+inGzm.S_Name+'】煤层平均厚度为' +
//                  FormatFloat('#.##',inGzm.S_Agv_mch) +'米, 设定开采高度为' +
//                  FormatFloat('#.##',inGzm.S_Cg_h)+'米, 采煤方法是' +
//                  Get_Cmff(inGzm.S_CMFS_INteger)+ ',工作面上界采深是'+FormatFloat('#.##',inGzm.S_Sh_UP)+
//                  '米,下界采深是'+FormatFloat('#.##',inGzm.S_Sh_Down)+'米，平均采深是'   +
//                  FormatFloat('#.##',inGzm.S_mcsd_h)+'米';
//      WriteText(str);
//      AddReturn();
//      str:='  该工作面推进长度是'+FormatFloat('#.##',inGzm.S_Sx_zx )+'米，'+
//                '倾斜长度是'+FormatFloat('#.##',inGzm.S_L_qx)+'米，'   +
//                '煤层硬度是'+Get_Coal_F(round(inGzm.S_f_PS))+',基岩厚度是'+Get_JYHd(inGzm.Dz_JYHD)+
//                ',每天推进'+FormatFloat('#.##',inGzm.S_DayStep_speed)+'米左右。' ;
//
//      WriteText(Str);
//      AddReturn();
//
//      Str:='  该次模拟计算使用的液压支架参数为:'+
//                '中心距：'+ FormatFloat('#.##',inGzm.Usedsupport.Zj_zhongxinju) +  '米,'+
//                '控顶距：'+ FormatFloat('#.##',inGzm.Usedsupport.Zj_KongdingJU) +  '米,'+
//                '合力作用点：'+ FormatFloat('#.##',inGzm.Usedsupport.Zj_hlzyd)  +  '米,'+
//                '立柱数量：'+ IntTostr(inGzm.Usedsupport.Zj_Lizhu_count) +  '个。';
//      WriteText(Str);
//      AddReturn();
     end;
  finally
     FreeandNil(RichEdit1);
  end;


end;

constructor TWordReport.Create;
begin
    CreateWordClass;

end;

procedure TWordReport.CreateWordClass;
begin
    if not Assigned(innWord) then
         innWord:= TMyWord.Create;


end;

procedure TWordReport.DeleteBmPFile;
var
 BmpPath:WideString;
begin
    BmpPath:=Public_Basic.Get_MyModulePath+'SaveBmp\FYYD\';
    if  DirectoryExists(BmpPath) then
        TDirectory.Delete(BmpPath, true);
    ForceDirectories(BmpPath);
end;

destructor TWordReport.Destroy;
begin
   FreeMyWordClass;

end;

procedure TWordReport.FreeMyWordClass();
begin
     if Assigned(innWord) then  FreeAndNil(innWord);

end;

function TWordReport.Get_BottomWater(id: integer): String;
begin
  case id of
     1: Result:='底板无水';
     2: Result:='底板有水源，较远';
     3: Result:='底板有水源，较近';
     4: Result:='曾发生底板突出事故';
     else  Result:='其他';
  end;
end;

function TWordReport.Get_Cmff(id: integer): String;
begin
    case id of
       1: Result:='炮采';
       2: Result:='普采';
       3: Result:='综采';
       else Result:='放顶煤';
    end;
end;

function TWordReport.Get_Coal_F(id: integer): String;
begin
   case id of
         1: Result:='普氏系数0.8以下';
         2: Result:='普氏系数0.8-1.5之间';
         3: Result:='普氏系数1.5-2.5之间';
         else Result:='普氏系数2.5以上';
   end;
end;

function TWordReport.Get_DZGZ(id: integer): String;
begin
   case id of
       1: Result:='地质构造较少';
       2: Result:='背斜轴部';
       3: Result:='向斜轴部';
       4: Result:='断层密集，但不影响推进';
       5: Result:='断层密集，影响推进';
       6: Result:='地质及其复杂';
   end;
end;

function TWordReport.Get_HangDao_Stress(id: integer): String;
begin
   case id  of
       1: Result:='基本无水平应力';
       2: Result:='水平应力小于垂直应力';
       3: Result:='水平应力与垂直应力相当';
       else Result:='水平应力大于垂直应力1.5倍以上';
   end;
end;

function TWordReport.Get_HangDao_support(id: integer): String;
begin
   case id of
       1: Result:='巷道基本不需要支护';
       2: Result:='巷道需要简单的锚网支护';
       3: Result:='巷道架棚支护，基本不变形';
       4: Result:='巷道变形，底鼓，变形小';
       else Result:='巷道急速变形，底鼓，严重影响生产';
   end;
end;

function TWordReport.Get_JYHD(id: integer): String;
begin
   case id of
     1: Result:='基岩层较薄';
     2: Result:='基岩层一般';
     3: Result:='基岩层较厚';
     else Result:='基岩层巨厚';
   end;
end;

function TWordReport.Get_RockPress(id: integer): String;
begin
   case id of
       1: Result:='矿压显现不明显';
       2: Result:='有矿压显现，不影响生产';
       3: Result:='矿压显现叫剧烈，影响生产';
       4: Result:='发生过顶板事故';
   end;
end;

function TWordReport.Get_support_type(id: integer): String;
begin
   case id of
      1: Result:='单体支护';
      2: Result:='综采液压支架';
   end;
end;

function TWordReport.Get_TopWater(id: integer): String;
begin
   case id of
     1: Result:='顶板无水';
     2: Result:='含水层距离顶板较远';
     3: Result:='含水层距离顶板较近';
     4: Result:='曾发生透水事故';
     else  Result:='其他';

  end;
end;

function TWordReport.Get_WSFC(id: integer): String;
begin
  case id of
      1: Result:='瓦斯含量较低';
      2: Result:='低瓦斯，但局部超限';
      3: Result:='高瓦斯';
  end;
end;

function TWordReport.Get_YxFx(id: integer): String;
begin
   case id of
      1: Result:='水平推进';
      2: Result:='仰斜推进';
      3: Result:='俯斜推进';
   end;
end;

function TWordReport.isExsitBmpFile(BmpFile: string): Boolean;
begin
    Result:=False;
    while not FileExists(BmpFile) do  sleep(100);
    Result:=true;

end;

procedure TWordReport.ReportAnsysisRockPress(AHandle: THandle; inGzm: TGZM);
var
  i:integer;
  pic_path:string;
begin
     ExHandle:=AHandle;
     Pic_Path:=Public_Basic.Get_MyModulePath;
     // 矿压观测报告
      CreateWordClass();
      with  innWord do begin
          OpenWord('');
          setpagemargin(25,20,25,20);
      end;
      // 控制页边距

        // 添加封面
      Add_Kyfx_Cover(MainDataModule.Coal_Name,MainDataModule.WorkFace_Name);
       // 添加第一章
      Add_WorkFace_BasicInformation(inGzm);

//         innWord.MoveEnd ;
//
//
//         innWord.AddReturn();
//
//         innWord.insertPage(0);
//          innWord.WriteText('1234567');
//         innWord.AddReturn();
//
//
//
//         for I := 1 to 50 do
//             innWord.AddLine('标题'+InttoStr(i),i); //报告标题   标题编号为1
//
//
//
//         innWord.insertPage(0);
//         innWord.insertPagenum  ;
//
//
//        innWord.createBookMark('目录');
//         innWord.insertPage(1);
//          innWord.WriteText('qwert');
//          innWord.insertPage(1);
//
//           innWord.WriteText('asdfgh');

   //   innWord.InsetWaterBmp ('C:\word\water1.bmp');

      //插入目录
     // Add_Contents;
     //文档添加水印
     innword.InsetWaterBmp(Pic_Path+'BJTP\water.bmp');
     FreeMyWordClass;
end;

procedure TWordReport.ReportYklh(AHandle:THandle;inGzm:TGzm);
begin
       CreateWordClass();
       innWord.OpenWord('');
       DeleteBmPFile; {删除文件夹}
       {提前调用，为文件保存预留时间}
//       Main_CallPStope.UsePStope.GetFyydBmp(AHandle);
//       Main_CallPStope.UsePStope.GetDTFZBmp(AHandle);
       // 添加标题
       AddDocmentTitle(MainDataModule.Coal_Name,MainDataModule.WorkFace_Name,
                       'Yklh');
      //添加工作面信息
       ADDWorkFaceInFo_1(inGzm);
       //添加钻孔基本信息
       ADDDrilleInFo_2(inGzm);
       //添加覆岩运动规律
       AddFYYDInfo_3(inGzm,'Yklh');
       //添加采动模拟仿真
       AddYDFZInfo_4(inGzm);
       //添加支架选型
       AddYklhInfo_5(inGzm);
       //添加支架专家意见表
//       AddSupSubject_6(inGzm);
//       //添加已存在液压支架信息
//       AddExsitSupport_7(inGzm);
       //免责声明
       Add_disclaimer('六');
       FreeMyWordClass();
end;

procedure TWordReport.ReportZhijia(AHandle:THandle;inGzm:TGzm);
begin
       CreateWordClass();
       innWord.OpenWord('');
       DeleteBmPFile; {删除文件夹}
       {提前调用，为文件保存预留时间}
//       Main_CallPStope.UsePStope.GetFyydBmp(AHandle);
//       Main_CallPStope.UsePStope.GetDTFZBmp(AHandle);
       // 添加标题
       AddDocmentTitle(MainDataModule.Coal_Name,MainDataModule.WorkFace_Name,
                       'Support' );
      //添加工作面信息
       ADDWorkFaceInFo_1(inGzm);
       //添加钻孔基本信息
       ADDDrilleInFo_2(inGzm);
       //添加覆岩运动规律
       AddFYYDInfo_3(inGzm,'Support');
       //添加采动模拟仿真
       AddYDFZInfo_4(inGzm);
       //添加支架选型
       AddSupportInfo_5(inGzm);
       //添加支架专家意见表
       AddSupSubject_6(inGzm);
       //添加已存在液压支架信息
//       AddExsitSupport_7(inGzm);
       //免责声明
       Add_disclaimer('八');
       FreeMyWordClass();
end;

function TWordReport.Report_Zcyl(inGzm:TGzm): Boolean;
 var
   s_temp:Str_DT_array;
   C1:integer;
begin
//*************
//     s_temp:=Public_Basic.split(Main_CallPStope.UsePStope.Get_Zcyl('2.0',inGzm.S_Jc_L),';',C1);
     if C1> 4 then  begin
         {内应力场峰值k1;内应力场s0; 外应力场峰值k2; 支承压力峰值距离煤壁距离s1; 外应力范围sx; }
         with innWord do begin
             WriteText('    内应力场峰值'+s_temp[0]);
                AddReturn();
             WriteText('    内应力场'+s_temp[1]+'米');
                 AddReturn();
             WriteText('    外应力场峰值'+s_temp[2]);
                 AddReturn();
             WriteText('    支承压力峰值距离煤壁距离'+s_temp[3]+'米');
                  AddReturn();
             WriteText('    外应力范围'+s_temp[4]+'米') ;
                 AddReturn();
         end;

     end;
end;

procedure TWordReport.SetDrawGraph(iDw: TDrawGrap);
begin
   iDwGrap:=iDw;
end;

end.
